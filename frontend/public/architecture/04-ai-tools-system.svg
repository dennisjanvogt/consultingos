<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 700" font-family="system-ui, -apple-system, sans-serif">
  <defs>
    <linearGradient id="aiGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6"/>
      <stop offset="100%" style="stop-color:#7c3aed"/>
    </linearGradient>
    <linearGradient id="greenGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981"/>
      <stop offset="100%" style="stop-color:#059669"/>
    </linearGradient>
    <filter id="shadow4" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="0" dy="3" stdDeviation="5" flood-opacity="0.12"/>
    </filter>
    <marker id="arrow4" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#8b5cf6"/>
    </marker>
    <marker id="arrow4g" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10b981"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" font-size="22" font-weight="600" fill="#1f2937">AI Tools System</text>
  <text x="400" y="55" text-anchor="middle" font-size="12" fill="#6b7280">User Input → LLM → Tool Execution → State Mutation</text>

  <!-- User Input -->
  <rect x="300" y="75" width="200" height="50" rx="25" fill="url(#aiGrad)" filter="url(#shadow4)"/>
  <text x="400" y="105" text-anchor="middle" font-size="13" font-weight="600" fill="white">User Input</text>
  <text x="400" y="95" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.8)">Text / Voice</text>

  <!-- Arrow down -->
  <path d="M400 125 L400 155" stroke="#8b5cf6" stroke-width="2" fill="none" marker-end="url(#arrow4)"/>

  <!-- Two paths: Spotlight and AIOrb -->
  <path d="M400 155 L400 170 L280 170 L280 190" stroke="#c4b5fd" stroke-width="2" fill="none"/>
  <path d="M400 155 L400 170 L520 170 L520 190" stroke="#c4b5fd" stroke-width="2" fill="none"/>

  <!-- Spotlight -->
  <rect x="180" y="190" width="200" height="70" rx="10" fill="#f5f3ff" stroke="#8b5cf6" stroke-width="2" filter="url(#shadow4)"/>
  <text x="280" y="220" text-anchor="middle" font-size="13" font-weight="600" fill="#7c3aed">Spotlight</text>
  <text x="280" y="240" text-anchor="middle" font-size="10" fill="#6b7280">Full Chat Interface</text>
  <text x="280" y="253" text-anchor="middle" font-size="9" fill="#9ca3af">All Tools Available</text>

  <!-- AIOrb -->
  <rect x="420" y="190" width="200" height="70" rx="10" fill="#fce7f3" stroke="#ec4899" stroke-width="2" filter="url(#shadow4)"/>
  <text x="520" y="220" text-anchor="middle" font-size="13" font-weight="600" fill="#be185d">AIOrb</text>
  <text x="520" y="240" text-anchor="middle" font-size="10" fill="#6b7280">Voice-Only Dashboard</text>
  <text x="520" y="253" text-anchor="middle" font-size="9" fill="#9ca3af">Dashboard Tools Only</text>

  <!-- Merge arrows -->
  <path d="M280 260 L280 280 L400 280 L400 300" stroke="#c4b5fd" stroke-width="2" fill="none"/>
  <path d="M520 260 L520 280 L400 280" stroke="#c4b5fd" stroke-width="2" fill="none"/>

  <!-- AI Agent -->
  <rect x="280" y="300" width="240" height="65" rx="10" fill="url(#aiGrad)" filter="url(#shadow4)"/>
  <text x="400" y="328" text-anchor="middle" font-size="14" font-weight="600" fill="white">aiAgent.ts</text>
  <text x="400" y="348" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.9)">Streaming + Tool Detection</text>

  <!-- Arrow to OpenRouter -->
  <path d="M400 365 L400 395" stroke="#8b5cf6" stroke-width="2" fill="none" marker-end="url(#arrow4)"/>

  <!-- OpenRouter API -->
  <rect x="250" y="395" width="300" height="60" rx="10" fill="#ecfdf5" stroke="#10b981" stroke-width="2" filter="url(#shadow4)"/>
  <text x="400" y="420" text-anchor="middle" font-size="13" font-weight="600" fill="#059669">OpenRouter API</text>
  <text x="400" y="440" text-anchor="middle" font-size="10" fill="#6b7280">LLM + Function Calling (tool_choice: auto)</text>

  <!-- Arrow to Tool Detection -->
  <path d="M400 455 L400 485" stroke="#10b981" stroke-width="2" fill="none" marker-end="url(#arrow4g)"/>

  <!-- Tool Calls Detected -->
  <rect x="320" y="485" width="160" height="40" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <text x="400" y="510" text-anchor="middle" font-size="11" font-weight="600" fill="#92400e">Tool Calls Detected</text>

  <!-- Fan out to tools -->
  <path d="M400 525 L400 545" stroke="#f59e0b" stroke-width="2" fill="none"/>
  <path d="M400 545 L150 545 L150 570" stroke="#d1d5db" stroke-width="1.5" fill="none"/>
  <path d="M400 545 L300 545 L300 570" stroke="#d1d5db" stroke-width="1.5" fill="none"/>
  <path d="M400 545 L400 570" stroke="#d1d5db" stroke-width="1.5" fill="none"/>
  <path d="M400 545 L500 545 L500 570" stroke="#d1d5db" stroke-width="1.5" fill="none"/>
  <path d="M400 545 L650 545 L650 570" stroke="#d1d5db" stroke-width="1.5" fill="none"/>

  <!-- Tool Categories -->
  <rect x="80" y="570" width="130" height="55" rx="6" fill="white" stroke="#8b5cf6" stroke-width="1.5" filter="url(#shadow4)"/>
  <text x="145" y="592" text-anchor="middle" font-size="10" font-weight="600" fill="#7c3aed">Window</text>
  <text x="145" y="608" text-anchor="middle" font-size="9" fill="#6b7280">open_app</text>
  <text x="145" y="620" text-anchor="middle" font-size="9" fill="#6b7280">close_app</text>

  <rect x="230" y="570" width="130" height="55" rx="6" fill="white" stroke="#10b981" stroke-width="1.5" filter="url(#shadow4)"/>
  <text x="295" y="592" text-anchor="middle" font-size="10" font-weight="600" fill="#059669">Calendar</text>
  <text x="295" y="608" text-anchor="middle" font-size="9" fill="#6b7280">create_event</text>
  <text x="295" y="620" text-anchor="middle" font-size="9" fill="#6b7280">list_events</text>

  <rect x="380" y="570" width="130" height="55" rx="6" fill="white" stroke="#f59e0b" stroke-width="1.5" filter="url(#shadow4)"/>
  <text x="445" y="592" text-anchor="middle" font-size="10" font-weight="600" fill="#92400e">Data</text>
  <text x="445" y="608" text-anchor="middle" font-size="9" fill="#6b7280">get_stock_quote</text>
  <text x="445" y="620" text-anchor="middle" font-size="9" fill="#6b7280">get_weather</text>

  <rect x="530" y="570" width="130" height="55" rx="6" fill="white" stroke="#ec4899" stroke-width="1.5" filter="url(#shadow4)"/>
  <text x="595" y="592" text-anchor="middle" font-size="10" font-weight="600" fill="#be185d">Dashboard</text>
  <text x="595" y="608" text-anchor="middle" font-size="9" fill="#6b7280">show_chart</text>
  <text x="595" y="620" text-anchor="middle" font-size="9" fill="#6b7280">show_table</text>

  <!-- More tools -->
  <text x="720" y="600" text-anchor="middle" font-size="20" fill="#9ca3af">...</text>

  <!-- State Mutation -->
  <path d="M295 625 L295 645 L400 645 L400 660" stroke="#22c55e" stroke-width="2" fill="none"/>
  <rect x="280" y="660" width="240" height="35" rx="8" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
  <text x="400" y="683" text-anchor="middle" font-size="12" font-weight="600" fill="#166534">Zustand Store Mutation</text>

  <!-- Tool Registry Info -->
  <rect x="620" y="75" width="150" height="90" rx="8" fill="#f9fafb" stroke="#e5e7eb" stroke-width="1"/>
  <text x="695" y="100" text-anchor="middle" font-size="11" font-weight="600" fill="#4b5563">Tool Registry</text>
  <text x="695" y="120" text-anchor="middle" font-size="10" fill="#6b7280">80+ Tools</text>
  <text x="695" y="135" text-anchor="middle" font-size="10" fill="#6b7280">13 Categories</text>
  <text x="695" y="150" text-anchor="middle" font-size="9" fill="#9ca3af">src/services/tools/</text>

  <!-- Legend -->
  <rect x="30" y="75" width="130" height="90" rx="8" fill="#f9fafb" stroke="#e5e7eb" stroke-width="1"/>
  <text x="95" y="100" text-anchor="middle" font-size="11" font-weight="600" fill="#4b5563">Flow Legend</text>
  <line x1="50" y1="115" x2="80" y2="115" stroke="#8b5cf6" stroke-width="2"/>
  <text x="90" y="119" font-size="9" fill="#6b7280">Internal</text>
  <line x1="50" y1="135" x2="80" y2="135" stroke="#10b981" stroke-width="2"/>
  <text x="90" y="139" font-size="9" fill="#6b7280">External API</text>
  <line x1="50" y1="155" x2="80" y2="155" stroke="#22c55e" stroke-width="2"/>
  <text x="90" y="159" font-size="9" fill="#6b7280">State Update</text>
</svg>
